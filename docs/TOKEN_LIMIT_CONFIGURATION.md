# ğŸ¯ Token Limit Configuration Guide

**NekoCode MCP Server Token Management** - å¤§å®¹é‡ASTå‡ºåŠ›ã®å®‰å…¨ãªåˆ¶å¾¡

æœ€çµ‚æ›´æ–°: 2025-08-13 | Version: 1.0 | ğŸ†• NEW!

---

## ğŸš¨ èƒŒæ™¯ï¼šãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™å•é¡Œ

### å•é¡Œã®ç™ºç”Ÿ
- **å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ASTå‡ºåŠ›**: 85,161ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆTypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ç­‰ï¼‰
- **Claude Code MCPåˆ¶é™**: é€šå¸¸25,000ãƒˆãƒ¼ã‚¯ãƒ³ç¨‹åº¦
- **çµæœ**: 3.4å€è¶…éã§MCPé€šä¿¡å¤±æ•—ã€Claude Codeã§è¡¨ç¤ºä¸å¯

### è§£æ±ºã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
1. **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã‚‹æŸ”è»Ÿãªåˆ¶é™å€¤è¨­å®š**
2. **æ®µéšçš„è­¦å‘Šã‚·ã‚¹ãƒ†ãƒ **
3. **å¼·åˆ¶å‡ºåŠ›ã‚ªãƒ—ã‚·ãƒ§ãƒ³**
4. **ä»£æ›¿æ‰‹æ®µã®è‡ªå‹•ææ¡ˆ**

---

## âš™ï¸ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

### nekocode_config.json ã®é…ç½®å ´æ‰€
```bash
# NekoCodeãƒã‚¤ãƒŠãƒªã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®
./target/release/nekocode_config.json
./target/debug/nekocode_config.json
./bin/nekocode_config.json  # Legacy C++ç‰ˆ
```

### å®Œå…¨ãªè¨­å®šä¾‹
```json
{
  "memory": {
    "edit_history": {
      "max_size_mb": 10,
      "min_files_keep": 10
    },
    "edit_previews": {
      "max_size_mb": 5
    }
  },
  "token_limits": {
    "ast_dump_max": 8000,
    "summary_threshold": 1000,
    "allow_force_output": true
  }
}
```

### token_limits è¨­å®šè©³ç´°

| è¨­å®šé …ç›® | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | èª¬æ˜ |
|----------|-------------|------|
| `ast_dump_max` | 8000 | ASTå‡ºåŠ›ã®ãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™ï¼ˆè§£æã‚¢ãƒ—ãƒªã¨ã—ã¦å®Ÿç”¨çš„ãªå€¤ï¼‰ |
| `summary_threshold` | 1000 | ã‚µã‚¤ã‚ºæƒ…å ±è¡¨ç¤ºé–‹å§‹ã®é–¾å€¤ |
| `allow_force_output` | true | å¼·åˆ¶å…¨å‡ºåŠ›ã®è¨±å¯è¨­å®š |

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. é€šå¸¸ä½¿ç”¨ï¼ˆåˆ¶é™å†…ï¼‰
```python
# 8000ãƒˆãƒ¼ã‚¯ãƒ³ä»¥å†…ã®å ´åˆ â†’ é€šå¸¸è¡¨ç¤º
mcp__nekocode__ast_dump(session_id="12345678")
```

### 2. åˆ¶é™è¶…éæ™‚ã®è­¦å‘Š
```python
# 8000ãƒˆãƒ¼ã‚¯ãƒ³è¶…éæ™‚ â†’ è­¦å‘Š + ä»£æ›¿æ¡ˆè¡¨ç¤º
ğŸš¨ **AST Dump ãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™è¶…é** (è¨­å®š: 8,000 tokens)

ğŸ“Š **å‡ºåŠ›ã‚µã‚¤ã‚ºåˆ†æ:**
â€¢ æ¨å®šãƒˆãƒ¼ã‚¯ãƒ³æ•°: **21,543 tokens**
â€¢ è¨­å®šåˆ¶é™: 8,000 tokens  
â€¢ è¶…éç‡: **2.7x**

ğŸš€ **é¸æŠè‚¢:**
1. **ast_stats**: çµ±è¨ˆã‚µãƒãƒªãƒ¼ã®ã¿ï¼ˆæ¨å¥¨ï¼‰
2. **å¼·åˆ¶å‡ºåŠ›**: `mcp__nekocode__ast_dump(session_id="12345678", force=True)`
3. **è¡Œæ•°åˆ¶é™**: limit=50 ç­‰ã§éƒ¨åˆ†è¡¨ç¤º
4. **è¨­å®šå¤‰æ›´**: nekocode_config.json ã§åˆ¶é™å€¤èª¿æ•´
```

### 3. å¼·åˆ¶å‡ºåŠ›
```python
# åˆ¶é™ã‚’ç„¡è¦–ã—ã¦å…¨å‡ºåŠ›
mcp__nekocode__ast_dump(session_id="12345678", force=True)
```

### 4. éƒ¨åˆ†è¡¨ç¤º
```python
# æœ€åˆ50è¡Œã®ã¿è¡¨ç¤º
mcp__nekocode__ast_dump(session_id="12345678", limit=50)
```

---

## ğŸ›ï¸ åˆ¶é™å€¤ã®èª¿æ•´

### ç”¨é€”åˆ¥æ¨å¥¨è¨­å®š

#### çµ±è¨ˆé‡è¦–ï¼ˆè»½é‡ï¼‰
```json
{
  "token_limits": {
    "ast_dump_max": 3000,
    "summary_threshold": 500,
    "allow_force_output": true
  }
}
```

#### ãƒãƒ©ãƒ³ã‚¹é‡è¦–ï¼ˆæ¨å¥¨ï¼‰
```json
{
  "token_limits": {
    "ast_dump_max": 8000,
    "summary_threshold": 1000,
    "allow_force_output": true
  }
}
```

#### ãƒ‡ãƒãƒƒã‚°é‡è¦–ï¼ˆå¤§å®¹é‡ï¼‰
```json
{
  "token_limits": {
    "ast_dump_max": 15000,
    "summary_threshold": 2000,
    "allow_force_output": true
  }
}
```

#### åˆ¶é™ãªã—ï¼ˆå±é™ºï¼‰
```json
{
  "token_limits": {
    "ast_dump_max": 999999,
    "summary_threshold": 5000,
    "allow_force_output": true
  }
}
```

---

## ğŸ’¡ æœ€é©ãªä½¿ã„æ–¹

### 1. ã¾ãš ast_stats ã‚’è©¦ã™ï¼ˆæ¨å¥¨ï¼‰
```python
# çµ±è¨ˆã‚µãƒãƒªãƒ¼ã§å…¨ä½“æŠŠæ¡
mcp__nekocode__ast_stats(session_id="12345678")

# å¿…è¦ã«å¿œã˜ã¦ASTè©³ç´°ã‚’ç¢ºèª
mcp__nekocode__ast_dump(session_id="12345678", limit=30)
```

### 2. æ®µéšçš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
```bash
# Step 1: ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ
session_id = mcp__nekocode__session_create(path="large-project/")

# Step 2: çµ±è¨ˆã§æ¦‚è¦æŠŠæ¡
mcp__nekocode__ast_stats(session_id=session_id)

# Step 3: å¿…è¦ã«å¿œã˜ã¦éƒ¨åˆ†è¡¨ç¤º
mcp__nekocode__ast_dump(session_id=session_id, limit=50)

# Step 4: æœ¬å½“ã«å¿…è¦ãªå ´åˆã®ã¿å…¨å‡ºåŠ›
mcp__nekocode__ast_dump(session_id=session_id, force=True)
```

### 3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦æ¨¡åˆ¥æˆ¦ç•¥

| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦æ¨¡ | æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ | è¨­å®š |
|----------------|---------------|------|
| å°è¦æ¨¡ï¼ˆ<10ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ | ASTç›´æ¥å‡ºåŠ›OK | `ast_dump_max: 15000` |
| ä¸­è¦æ¨¡ï¼ˆ10-100ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ | çµ±è¨ˆ â†’ éƒ¨åˆ†å‡ºåŠ› | `ast_dump_max: 8000` |
| å¤§è¦æ¨¡ï¼ˆ100+ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ | çµ±è¨ˆã®ã¿æ¨å¥¨ | `ast_dump_max: 3000` |

---

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Q: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œãªã„
**A**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®å ´æ‰€ã‚’ç¢ºèª
```bash
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
ls -la target/release/nekocode_config.json
ls -la target/debug/nekocode_config.json

# MCPã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã§è¨­å®šèª­ã¿è¾¼ã¿ç¢ºèª
# ã€ŒğŸ“‹ Config loaded from: /path/to/nekocode_config.jsonã€ãŒå‡ºåŠ›ã•ã‚Œã‚‹
```

### Q: å¼·åˆ¶å‡ºåŠ›ãŒåŠ¹ã‹ãªã„
**A**: è¨­å®šã§ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèª
```json
{
  "token_limits": {
    "allow_force_output": true  // ã“ã‚ŒãŒfalseã ã¨å¼·åˆ¶å‡ºåŠ›ä¸å¯
  }
}
```

### Q: åˆ¶é™å€¤ã‚’å¤‰æ›´ã—ãŸã®ã«åæ˜ ã•ã‚Œãªã„
**A**: MCPã‚µãƒ¼ãƒãƒ¼ã®å†èµ·å‹•ãŒå¿…è¦
```bash
# Claude Codeã‚’å†èµ·å‹•ã—ã¦MCPã‚µãƒ¼ãƒãƒ¼ã‚’å†èª­ã¿è¾¼ã¿
```

### Q: JSONå½¢å¼ã‚¨ãƒ©ãƒ¼
**A**: JSONæ§‹æ–‡ã®ç¢ºèª
```bash
# JSONæ§‹æ–‡ãƒã‚§ãƒƒã‚¯
python3 -m json.tool nekocode_config.json
```

---

## ğŸ“Š æ€§èƒ½ã¸ã®å½±éŸ¿

### ãƒˆãƒ¼ã‚¯ãƒ³æ•°æ¨å®šã®è¨ˆç®—ã‚³ã‚¹ãƒˆ
- **æ¨å®šæ–¹æ³•**: æ–‡å­—æ•° Ã· 4 = è¿‘ä¼¼ãƒˆãƒ¼ã‚¯ãƒ³æ•°
- **è¨ˆç®—æ™‚é–“**: <1msï¼ˆç„¡è¦–å¯èƒ½ï¼‰
- **ãƒ¡ãƒ¢ãƒªå½±éŸ¿**: ç„¡ã—

### åˆ¶é™ãƒã‚§ãƒƒã‚¯ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰
- **è¿½åŠ æ™‚é–“**: 2-3ms
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨**: å‡ºåŠ›ã‚µã‚¤ã‚ºã«æ¯”ä¾‹
- **å…¨ä½“ã¸ã®å½±éŸ¿**: <1%

---

## ğŸ¯ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### é–‹ç™ºãƒ•ãƒ­ãƒ¼ã§ã®æ´»ç”¨
1. **åˆæœŸèª¿æŸ»**: `ast_stats` ã§å…¨ä½“æŠŠæ¡
2. **è©³ç´°ç¢ºèª**: `limit=30` ã§è¦ç‚¹ç¢ºèª
3. **å¿…è¦æ™‚ã®ã¿**: `force=True` ã§å…¨å‡ºåŠ›
4. **è¨­å®šèª¿æ•´**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦æ¨¡ã«å¿œã˜ãŸåˆ¶é™å€¤è¨­å®š

### ãƒãƒ¼ãƒ è¨­å®šã®çµ±ä¸€
```bash
# ãƒãƒ¼ãƒ å…±é€šè¨­å®šã‚’ãƒªãƒã‚¸ãƒˆãƒªã«å«ã‚ã‚‹
cp nekocode_config.json.template nekocode_config.json
git add nekocode_config.json
```

### CI/CDçµ±åˆ
```bash
# GitHub Actionsã§ãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™ç„¡åŠ¹åŒ–
export NEKOCODE_CONFIG='{"token_limits":{"ast_dump_max":999999}}'
```

---

**ğŸ‰ ã“ã®è¨­å®šã«ã‚ˆã‚Šã€NekoCodeã¯å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚å®‰å…¨ã‹ã¤æŸ”è»Ÿã«å‹•ä½œã—ã¾ã™ï¼**